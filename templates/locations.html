<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choose Location - UtsavDarshan</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
</head>
<body>
    <header>
        <nav>
            <div class="nav-container">
                <h1>UtsavDarshan</h1>
                <a href="{{ url_for('index') }}" class="btn">Home</a>
            </div>
        </nav>
    </header>

    <main>
        <section class="location-selection">
            <h2>Choose a Taluka in Maharashtra</h2>
            <div class="taluka-list">
                {% for taluka in talukas %}
                <button class="taluka-btn" data-taluka="{{ taluka.name }}">{{ taluka.name }}</button>
                {% endfor %}
            </div>
        </section>

        <section class="map-section">
            <h2>Pandals on Map</h2>
            <div id="map" style="width: 100%; height: 400px;"></div>
        </section>
    </main>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiZXhhbXBsZSIsImEiOiJjbGV4YW1wbGUifQ.example'; // Replace with your Mapbox access token
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [72.8777, 19.0760], // Mumbai center
            zoom: 10
        });

        const talukasData = JSON.parse('{{ talukas|tojson }}');
        const talukaButtons = document.querySelectorAll('.taluka-btn');
        talukaButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const talukaName = btn.getAttribute('data-taluka');
                const selected = talukasData.find(t => t.name === talukaName);
                if (selected) {
                    // Add markers for selected.pandals
                    selected.pandals.forEach(pandal => {
                        new mapboxgl.Marker()
                            .setLngLat([pandal.location.lng, pandal.location.lat])
                            .setPopup(new mapboxgl.Popup().setHTML(`<h3>${pandal.name}</h3><p>${pandal.history}</p>`))
                            .addTo(map);
                    });
                    // Fit map to markers
                    if (selected.pandals.length > 0) {
                        const bounds = new mapboxgl.LngLatBounds();
                        selected.pandals.forEach(p => bounds.extend([p.location.lng, p.location.lat]));
                        map.fitBounds(bounds, { padding: 20 });
                    }
                }
            });
        });
    </script>
</body>
</html>
